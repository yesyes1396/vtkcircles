{% extends "base.html" %}
{% block title %}{{ app_name }} — Портал секций{% endblock %}

{% block content %}
<div class="hero text-center">
    <h1><i class="fas fa-star"></i> {{ app_name }}</h1>
    <p class="lead">Каталог секций и кружков для студентов и школьников</p>
    {% if not current_user.is_authenticated %}
        <a href="/register" class="btn btn-light btn-lg"><i class="fas fa-user-plus"></i> Присоединиться</a>
    {% endif %}
</div>

<!-- Search -->
<div class="search-form">
    <form method="get" class="row g-2 align-items-end">
        <div class="col-12 col-md-4">
            <input type="text" name="search" class="form-control" placeholder="Поиск по названию..." value="{{ search }}">
        </div>
        <div class="col-6 col-md-2">
            <select name="category" class="form-select">
                <option value="">Все категории</option>
                {% for cat in categories %}
                <option value="{{ cat }}" {% if cat == category %}selected{% endif %}>{% if cat == 'sports' %}Спорт{% elif cat == 'art' %}Искусство{% elif cat == 'science' %}Наука{% elif cat == 'music' %}Музыка{% else %}{{ cat }}{% endif %}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-3 col-md-2">
            <input type="number" name="min_age" class="form-control" placeholder="От" min="5" max="18" value="{{ min_age }}">
        </div>
        <div class="col-3 col-md-2">
            <input type="number" name="max_age" class="form-control" placeholder="До" min="5" max="18" value="{{ max_age }}">
        </div>
        <div class="col-6 col-md-1">
            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-search"></i></button>
        </div>
        <div class="col-6 col-md-1">
            <a href="/" class="btn btn-outline-secondary w-100"><i class="fas fa-times"></i></a>
        </div>
    </form>
</div>

<!-- Course grid -->
{% if courses.items %}
<div class="row g-4">
    {% for course in courses.items %}
    <div class="col-12 col-md-6 col-lg-4">
        <div class="card course-card h-100">
            <div class="course-card-header {% if not course.image %}no-image{% endif %}">
                {% if course.image %}
                    <img src="/{{ course.image }}" alt="{{ course.name }}">
                {% else %}
                    <i class="fas fa-camera-retro"></i>
                {% endif %}
            </div>
            <div class="course-card-body d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-1">
                    <span class="course-category">{% if course.category == 'sports' %}Спорт{% elif course.category == 'art' %}Искусство{% elif course.category == 'science' %}Наука{% elif course.category == 'music' %}Музыка{% else %}{{ course.category }}{% endif %}</span>
                    {% if course.avg_rating %}<span class="text-warning small"><i class="fas fa-star"></i> {{ course.avg_rating }}</span>{% endif %}
                </div>
                <h5 class="course-title">{{ course.name }}</h5>
                {% if course.description %}
                    <p class="text-muted small mb-2">{{ course.description[:100] }}{% if course.description|length > 100 %}...{% endif %}</p>
                {% endif %}
                <div class="course-info"><i class="fas fa-birthday-cake"></i> {{ course.min_age }}–{{ course.max_age }} лет</div>
                {% if course.schedule %}<div class="course-info"><i class="fas fa-calendar"></i> {{ course.schedule }}</div>{% endif %}
                <div class="mt-auto pt-2">
                    {% if course.is_full %}
                        <small class="slots-full"><i class="fas fa-ban"></i> Мест нет</small>
                    {% else %}
                        <small class="slots-available"><i class="fas fa-check-circle"></i> {{ course.available_slots }} мест</small>
                    {% endif %}
                    <a href="/course/{{ course.id }}" class="btn btn-primary w-100 mt-2 btn-sm">Подробнее</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if courses.pages > 1 %}
<nav class="mt-4">
    <ul class="pagination justify-content-center">
        {% if courses.has_prev %}
            <li class="page-item"><a class="page-link" href="?page={{ courses.prev_num }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if min_age %}&min_age={{ min_age }}{% endif %}{% if max_age %}&max_age={{ max_age }}{% endif %}">&laquo;</a></li>
        {% endif %}
        {% for p in courses.iter_pages() %}
            {% if p %}
                <li class="page-item {% if p == courses.page %}active{% endif %}"><a class="page-link" href="?page={{ p }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if min_age %}&min_age={{ min_age }}{% endif %}{% if max_age %}&max_age={{ max_age }}{% endif %}">{{ p }}</a></li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">…</span></li>
            {% endif %}
        {% endfor %}
        {% if courses.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ courses.next_num }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if min_age %}&min_age={{ min_age }}{% endif %}{% if max_age %}&max_age={{ max_age }}{% endif %}">&raquo;</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="no-results">
    <i class="fas fa-search fa-3x mb-3"></i>
    <h4>Ничего не найдено</h4>
    <p>Попробуйте изменить параметры поиска</p>
</div>
{% endif %}
{% endblock %}
